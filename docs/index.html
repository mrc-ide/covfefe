<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulation of falciparum genetic data • covfefe</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><meta property="og:title" content="Simulation of falciparum genetic data">
<meta property="og:description" content="More about what it does (maybe more than one line)
    Use four spaces when indenting paragraphs within the Description.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">covfefe</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="contents col-md-9">
    <div id="covfefe" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#covfefe" class="anchor"></a>covfefe</h1></div>
<div id="version-0-1" class="section level3">
<h3 class="hasAnchor">
<a href="#version-0-1" class="anchor"></a>Version 0.1</h3>

<p>The R package <em>covfefe</em> performs Computational Validation For Estimating Falciparum Epidemiology (ahem). More specifically, it provides a flexible framework for simulating genetic data from <em>P. falciparum</em> transmission models.</p>
<p>We start with data on infection histories - i.e. who became infected when, who did this infection originate from, when did this episode recover, etc. We then specify a subset of samples that we are interested in - for example, 100 individuals at day 365. <em>covfefe</em> then prunes the infection history data down to a reduced set that contains only the events that directly impact on the samples that we are interested in. Often the number of sampled hosts is far smaller than the total infected population, or perhaps sampling only occurs at a few time points, meaning the pruned infection history can be <em>much</em> smaller than the complete infection history. Finally, <em>covfefe</em> simulates genetic data from the pruned infection history and from a set of user-defined parameters that specify the genetic model, for example the recombination rate and the number of loci.</p>
<p align="center">
<img src="https://raw.githubusercontent.com/mrc-ide/covfefe/master/R_ignore/covfefe_flow.png" width="700" align="middle"></p>
<p>By using the infection history as the starting point we ensure that multiple epidemiological models can be plugged into the same tool. Any malaria transmission model that generates infection history data in the format required by <em>covfefe</em> can be used to simulate genetic data, and this format has been designed to be flexible enough to encompass a wide range of models. <em>covfefe</em> also contains it sown simple individual-based model that simulates malaria transmission in multiple demes (partially isolated subpopulations), with or without migration between demes.</p>
<p><strong>This package is still in development</strong>, meaning methods are likely to change in the near future. That being said, here are instructions on how to install and run <em>covfefe</em> as it currently stands.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p><em>covfefe</em> relies on the Rcpp package, which requires the following OS-specific steps:</p>
<ul>
<li>Windows
<ul>
<li>Download and install the appropriate version of <a href="https://cran.rstudio.com/bin/windows/Rtools/">Rtools</a> for your version of R. On installation, ensure you check the box to arrange your system PATH as recommended by Rtools</li>
</ul>
</li>
<li>Mac OS X
<ul>
<li>Download and install <a href="http://itunes.apple.com/us/app/xcode/id497799835?mt=12">XCode</a>
</li>
<li>Within XCode go to Preferences : Downloads and install the Command Line Tools</li>
</ul>
</li>
<li>Linux (Debian/Ubuntu)
<ul>
<li>
<p>Install the core software development utilities required for R package development as well as LaTeX by executing</p>
<div class="sourceCode"><pre class="sourceCode R"><code class="sourceCode r"><span class="st">```</span>
<span class="dt">sudo apt-get install r-base-dev texlive-full</span>
<span class="st">```</span></code></pre></div>
</li>
</ul>
</li>
</ul>
<p>Next, ensure that you have devtools installed by running</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"devtools"</span>)</code></pre></div>
<p>Finally, install the <em>covfefe</em> package directly from GitHub by running</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">install_github</span>(<span class="st">"mrc-ide/covfefe"</span>)
<span class="kw">library</span>(covfefe)</code></pre></div>
</div>
<div id="example-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#example-analysis" class="anchor"></a>Example analysis</h2>
<div id="loading-infection-history" class="section level3">
<h3 class="hasAnchor">
<a href="#loading-infection-history" class="anchor"></a>Loading infection history</h3>
<p>The analysis pipeline starts by creating a covfefe project. This project will hold all inputs and outputs used by the package, and is a convenient way of keeping everything we need in one place.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myproj &lt;-<span class="st"> </span><span class="kw"><a href="reference/covfefe_project.html">covfefe_project</a></span>()</code></pre></div>
<p>Running <code>names(myproj)</code> we can see all the elements that make up a <em>covfefe</em> project, including parameters, distributions, etc. We will talk about each of these elements in due course.</p>
<p>To begin with we need some data on infection histories. For convenience, we will use the in-built individual-based model with default settings, which simulates transmission in a single population.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mysim &lt;-<span class="st"> </span><span class="kw"><a href="reference/sim_indiv.html">sim_indiv</a></span>()</code></pre></div>
<p>Again, running <code>names(mysim)</code> we can see the elements that make up <code>mysim</code>, including <code>H</code> - the human population size in each deme, <code>daily_counts</code> - the number of susceptible vs. singly-infected vs. doubly-infected (and so on) individuals on each day, and <code>infection_history</code> - a complete list of critical events. For those who want to understand the infection history format, details can be found <em>here</em> (<strong>TODO - link to format</strong>).</p>
<p><strong>TODO - demonstrate plotting functions for simulated data</strong>.</p>
<p>We continue by loading the infection history into our project.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myproj &lt;-<span class="st"> </span><span class="kw"><a href="reference/assign_infection_history.html">assign_infection_history</a></span>(myproj, mysim$infection_history)</code></pre></div>
</div>
<div id="sampling-and-pruning" class="section level3">
<h3 class="hasAnchor">
<a href="#sampling-and-pruning" class="anchor"></a>Sampling and pruning</h3>
<p>Next, we need to specify how many human hosts we want to sample from. We do this using a simple matrix or data frame with three columns: column 1 gives the time of sampling, column 2 gives the deme that we are sampling from, and column 3 gives the number of hosts to draw at random from the pool of blood-stage individuals at that point in time. Note that in column 3, a value of -1 indicates that all blood stage hosts should be sampled. In this example, we will sample at day 100 and day 365, in a single deme (we only have one deme), and drawing all hosts at the first time point and 100 hosts at the second time point.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mysamp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">times =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">365</span>), <span class="dt">demes =</span> <span class="dv">1</span>, <span class="dt">hosts =</span> <span class="kw">c</span>(-<span class="dv">1</span>, <span class="dv">100</span>))</code></pre></div>
<p>Next we load this data into our project, taking care to specify the number of demes, which is not always completely obvious from the infection history and sampling data alone.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myproj &lt;-<span class="st"> </span><span class="kw"><a href="reference/sample_hosts.html">sample_hosts</a></span>(myproj, mysamp, <span class="dt">demes =</span> <span class="dv">1</span>)</code></pre></div>
<p>Finally we prune the infection history down based on the sampling data. Once we have done this, we are free to delete the original infection history data from the project. Doing so will free up space, which might be limited if the infection history data is very large, but will also mean we cannot re-run <code>sample_hosts</code> without first re-loading the infection history data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myproj &lt;-<span class="st"> </span><span class="kw"><a href="reference/prune.html">prune</a></span>(myproj)
myproj &lt;-<span class="st"> </span><span class="kw"><a href="reference/delete_infection_history.html">delete_infection_history</a></span>(myproj)</code></pre></div>
</div>
<div id="simulating-genetic-data" class="section level3">
<h3 class="hasAnchor">
<a href="#simulating-genetic-data" class="anchor"></a>Simulating genetic data</h3>
<p>Now that we know which transmission events we are interested in, we can simulate the passing down of genetic information through this infection tree. Two of the most important variables from the genetic point of view are the number of oocysts that develop in the mosquito to produce viable sporozoites, and the number of sporozoites that make it to the liver of a newly infected host to form viable hepatic schizonts. Each of these variables can be specified in terms of a full probability distribution, which is drawn from independently each time a mosquito or human becomes infected.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myproj &lt;-<span class="st"> </span><span class="kw">define_oocyst_distribution</span>(myproj, <span class="dt">oocysts =</span> <span class="kw">dpois</span>(<span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">lambda =</span> <span class="dv">1</span>))
myproj &lt;-<span class="st"> </span><span class="kw">define_hepatocyte_distribution</span>(myproj, <span class="dt">hepatocytes =</span> <span class="kw">dpois</span>(<span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">lambda =</span> <span class="dv">1</span>))</code></pre></div>
<p>Any distribution can be used, but note that these distributions are assumed to start from 1, as a value of 0 oocysts or 0 hepatic schizonts is impossible given that transmission occured.</p>
<p>Next we must define the loci that we are interested in. We define these in a list of up to 14 elements (one for each chromosome), with each consisting of a vector of genomic positions (in base pairs). In this example our target loci are evenly tiled over chromosomes 1 and 3.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myloci &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">64e4</span>, <span class="fl">1e4</span>), <span class="ot">NULL</span>, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">100e4</span>, <span class="fl">1e4</span>))</code></pre></div>
<p>Finally we can simulate some genetic data. At this stage we also specify the recombination rate in events per base-pair.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myproj &lt;-<span class="st"> </span><span class="kw"><a href="reference/sim_genotypes.html">sim_genotypes</a></span>(myproj, myloci, <span class="dt">recom_rate =</span> <span class="fl">0.001</span>)</code></pre></div>
<p>Further details of the genetic model can be found <em>here</em> (<strong>TODO - link to details of genetic model</strong>).</p>
</div>
<div id="visualising-results" class="section level3">
<h3 class="hasAnchor">
<a href="#visualising-results" class="anchor"></a>Visualising results</h3>
<p><strong>TODO - final genotype output is currently in a very unintuitive form. Need to decide on a final output format, and produce some plotting functions</strong></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=covfefe">https://​cloud.r-project.org/​package=covfefe</a>
</li>
<li>Report a bug at <br><a href="NA">NA</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Bob Verity <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/mrc-ide/covfefe"><img src="https://travis-ci.org/mrc-ide/covfefe.svg?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/mrc-ide/covfefe"><img src="https://ci.appveyor.com/api/projects/status/github/mrc-ide/covfefe?branch=master&amp;svg=true" alt="AppVeyor Build Status"></a></li>
<li><a href="https://codecov.io/github/mrc-ide/covfefe?branch=master"><img src="https://img.shields.io/codecov/c/github/mrc-ide/covfefe/master.svg" alt="Coverage Status"></a></li>
<li><a href="https://mrc-ide.github.io/covfefe/"><img src="https://img.shields.io/badge/documentation-click%20here!-blue.svg" alt="Documentation"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Bob Verity.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
